<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Time Progress Tracker</title>
    <!-- Tailwind via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React 18 UMD builds -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel Standalone so the browser understands JSX in the next script tag -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-slate-950">
    <div id="root"></div>

    <!-- Your app code (JSX allowed because type='text/babel') -->
    <script type="text/babel">
      const { useEffect, useMemo, useState } = React;

      function toLocalInputValue(date) {
        const off = date.getTimezoneOffset();
        const local = new Date(date.getTime() - off * 60 * 1000);
        return local.toISOString().slice(0, 16);
      }
      function formatDuration(ms) {
        const sign = ms < 0 ? -1 : 1;
        ms = Math.abs(ms);
        const sec = Math.floor(ms / 1000);
        const s = sec % 60;
        const m = Math.floor(sec / 60) % 60;
        const h = Math.floor(sec / 3600) % 24;
        const d = Math.floor(sec / 86400);
        const parts = [];
        if (d) parts.push(`${d}d`);
        if (h || d) parts.push(`${h}h`);
        parts.push(`${String(m).padStart(2, "0")}m`);
        parts.push(`${String(s).padStart(2, "0")}s`);
        return (sign < 0 ? "-" : "") + parts.join(" ");
      }
      function humanize(ms) {
        const sign = ms < 0 ? -1 : 1;
        ms = Math.abs(ms);
        const sec = Math.floor(ms / 1000);
        const s = sec % 60;
        const m = Math.floor(sec / 60) % 60;
        const h = Math.floor(sec / 3600) % 24;
        const d = Math.floor(sec / 86400);
        const parts = [];
        if (d) parts.push(`${d} ${d === 1 ? "day" : "days"}`);
        if (h) parts.push(`${h} ${h === 1 ? "hour" : "hours"}`);
        if (m) parts.push(`${m} ${m === 1 ? "minute" : "minutes"}`);
        if (s || parts.length === 0) parts.push(`${s} ${s === 1 ? "second" : "seconds"}`);
        return (sign < 0 ? "-" : "") + parts.join(" ");
      }
      function formatClock(date) {
        return date.toLocaleString(undefined, {
          year: "numeric",
          month: "short",
          day: "2-digit",
          hour: "numeric",
          minute: "2-digit",
          second: "2-digit",
        });
      }

      function TimeProgressApp() {
        const now0 = new Date();
        const [useLiveNow, setUseLiveNow] = useState(true);
        const [startStr, setStartStr] = useState(() => toLocalInputValue(new Date(now0.getTime() - 60 * 60 * 1000)));
        const [endStr, setEndStr] = useState(() => toLocalInputValue(new Date(now0.getTime() + 3 * 60 * 60 * 1000)));
        const [currentStr, setCurrentStr] = useState(() => toLocalInputValue(now0));

        const [nowMs, setNowMs] = useState(Date.now());
        useEffect(() => {
          if (!useLiveNow) return;
          const id = setInterval(() => setNowMs(Date.now()), 1000);
          return () => clearInterval(id);
        }, [useLiveNow]);

        const start = useMemo(() => (startStr ? new Date(startStr) : null), [startStr]);
        const end = useMemo(() => (endStr ? new Date(endStr) : null), [endStr]);
        const current = useMemo(
          () => (useLiveNow ? new Date(nowMs) : currentStr ? new Date(currentStr) : null),
          [useLiveNow, currentStr, nowMs]
        );

        const totalMs = useMemo(() => (start && end ? end.getTime() - start.getTime() : NaN), [start, end]);
        const elapsedMs = useMemo(() => (start && current ? current.getTime() - start.getTime() : NaN), [start, current]);
        const remainingMs = useMemo(() => (end && current ? end.getTime() - current.getTime() : NaN), [end, current]);

        const pctRaw = useMemo(
          () => (isFinite(elapsedMs) && isFinite(totalMs) && totalMs !== 0 ? (elapsedMs / totalMs) * 100 : NaN),
          [elapsedMs, totalMs]
        );
        const pctClamped = Math.max(0, Math.min(100, isFinite(pctRaw) ? pctRaw : 0));

        const invalidRange = useMemo(() => {
          if (!start || !end) return false;
          return end.getTime() <= start.getTime();
        }, [start, end]);

        return (
          <div className="min-h-screen w-full bg-gradient-to-b from-slate-900 to-slate-950 text-slate-100">
            <div className="max-w-5xl mx-auto px-4 py-10">
              <header className="mb-8">
                <h1 className="text-3xl sm:text-4xl font-semibold tracking-tight">Time Progress Tracker</h1>
                <p className="text-slate-300 mt-2">
                  Enter a start, optional current, and end time. Watch live progress, remaining time, and contextual timestamps.
                </p>
              </header>

              <section className="grid md:grid-cols-2 gap-6 lg:grid-cols-3">
                <div className="bg-slate-800/50 border border-slate-700 rounded-2xl p-4">
                  <label className="block text-sm text-slate-300 mb-2" htmlFor="start">Start time</label>
                  <input
                    id="start"
                    type="datetime-local"
                    value={startStr}
                    onChange={(e) => setStartStr(e.target.value)}
                    className="w-full rounded-xl bg-slate-900 border border-slate-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
                  />
                  <div className="mt-3 flex gap-2 flex-wrap">
                    <button
                      className="px-3 py-1.5 rounded-xl bg-slate-700 hover:bg-slate-600 text-sm"
                      onClick={() => setStartStr(toLocalInputValue(new Date()))}
                    >
                      Set to now
                    </button>
                    <button
                      className="px-3 py-1.5 rounded-xl bg-slate-700 hover:bg-slate-600 text-sm"
                      onClick={() => setStartStr(toLocalInputValue(new Date(new Date().getTime() - 60 * 60 * 1000)))}
                    >
                      Now − 1h
                    </button>
                  </div>
                </div>

                <div className="bg-slate-800/50 border border-slate-700 rounded-2xl p-4">
                  <label className="block text-sm text-slate-300 mb-2" htmlFor="end">End time</label>
                  <input
                    id="end"
                    type="datetime-local"
                    value={endStr}
                    onChange={(e) => setEndStr(e.target.value)}
                    className="w-full rounded-xl bg-slate-900 border border-slate-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
                  />
                  <div className="mt-3 flex gap-2 flex-wrap">
                    {["+30m", "+1h", "+2h", "+4h"].map((lab) => (
                      <button
                        key={lab}
                        className="px-3 py-1.5 rounded-xl bg-slate-700 hover:bg-slate-600 text-sm"
                        onClick={() => {
                          const mult = lab.endsWith("m") ? 60 * 1000 : 60 * 60 * 1000;
                          const qty = parseInt(lab.slice(1));
                          const base = useLiveNow ? new Date() : (current ? current : new Date());
                          const newEnd = new Date(base.getTime() + qty * mult);
                          setEndStr(toLocalInputValue(newEnd));
                        }}
                      >{lab}</button>
                    ))}
                  </div>
                </div>

                <div className="bg-slate-800/50 border border-slate-700 rounded-2xl p-4">
                  <div className="flex items-center justify-between mb-2">
                    <label className="block text-sm text-slate-300" htmlFor="current">Current time (optional)</label>
                    <label className="inline-flex items-center gap-2 text-xs text-slate-300">
                      <input
                        type="checkbox"
                        className="accent-indigo-500"
                        checked={useLiveNow}
                        onChange={(e) => setUseLiveNow(e.target.checked)}
                      />
                      Use live clock
                    </label>
                  </div>
                  <input
                    id="current"
                    type="datetime-local"
                    value={currentStr}
                    disabled={useLiveNow}
                    onChange={(e) => setCurrentStr(e.target.value)}
                    className="w-full rounded-xl bg-slate-900 border border-slate-700 px-3 py-2 disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-indigo-400"
                  />
                  {!useLiveNow && (
                    <div className="mt-3 flex gap-2 flex-wrap">
                      <button className="px-3 py-1.5 rounded-xl bg-slate-700 hover:bg-slate-600 text-sm" onClick={() => setCurrentStr(toLocalInputValue(new Date()))}>Set to now</button>
                    </div>
                  )}
                </div>
              </section>

              {invalidRange && (
                <div className="mt-4 rounded-xl border border-amber-500/50 bg-amber-500/10 text-amber-200 p-3">
                  End time must be after start time.
                </div>
              )}

              <section className="mt-8 grid gap-6 md:grid-cols-2">
                <div className="bg-slate-800/50 border border-slate-700 rounded-2xl p-6">
                  <h2 className="text-lg font-medium mb-4">Time Remaining</h2>
                  {isFinite(remainingMs) ? (
                    <div>
                      <div className="text-3xl font-semibold tracking-tight">
                        {remainingMs >= 0 ? formatDuration(remainingMs) : `${formatDuration(remainingMs)} (past)`}
                      </div>
                      <p className="text-slate-300 mt-2">
                        {remainingMs > 0 ? (
                          <>Goal ends in <span className="font-medium text-slate-100">{humanize(remainingMs)}</span>.</>
                        ) : remainingMs === 0 ? (
                          <>Goal ends <span className="font-medium text-slate-100">now</span>.</>
                        ) : (
                          <>Goal ended <span className="font-medium text-slate-100">{humanize(-remainingMs)}</span> ago.</>
                        )}
                      </p>
                      {end && (
                        <p className="text-slate-400 text-sm mt-2">End @ {formatClock(end)}</p>
                      )}
                    </div>
                  ) : (
                    <p className="text-slate-300">Enter start, current, and end times.</p>
                  )}
                </div>

                <div className="bg-slate-800/50 border border-slate-700 rounded-2xl p-6">
                  <h2 className="text-lg font-medium mb-4">Progress</h2>
                  {isFinite(pctClamped) && isFinite(pctRaw) && !invalidRange ? (
                    <div>
                      <div className="flex items-baseline gap-3">
                        <div className="text-4xl font-semibold tabular-nums">{pctRaw.toFixed(2)}%</div>
                        <div className="text-slate-400 text-sm">elapsed</div>
                      </div>
                      <div
                        className="mt-4 h-4 w-full rounded-full bg-slate-900 border border-slate-700 overflow-hidden"
                        role="progressbar"
                        aria-valuenow={Math.round(pctClamped)}
                        aria-valuemin={0}
                        aria-valuemax={100}
                      >
                        <div
                          className="h-full bg-gradient-to-r from-indigo-400 via-indigo-500 to-indigo-600"
                          style={{ width: `${pctClamped}%`, transition: "width 200ms linear" }}
                        />
                      </div>
                      <div className="mt-3 grid grid-cols-3 gap-3 text-sm text-slate-300">
                        <div><span className="text-slate-400">Elapsed:</span> {isFinite(elapsedMs) ? formatDuration(elapsedMs) : "—"}</div>
                        <div><span className="text-slate-400">Remaining:</span> {isFinite(remainingMs) ? formatDuration(remainingMs) : "—"}</div>
                        <div><span className="text-slate-400">Total:</span> {isFinite(totalMs) ? formatDuration(totalMs) : "—"}</div>
                      </div>
                    </div>
                  ) : (
                    <p className="text-slate-300">Enter valid times to see progress.</p>
                  )}
                </div>
              </section>

              <section className="mt-6 bg-slate-800/50 border border-slate-700 rounded-2xl p-6">
                <h2 className="text-lg font-medium mb-4">Context</h2>
                {end && isFinite(remainingMs) && current ? (
                  <div className="text-slate-300">
                    {remainingMs > 0 ? (
                      <>
                        If the goal ends in <span className="text-slate-100 font-medium">{humanize(remainingMs)}</span>, then <span className="text-slate-100 font-medium">{humanize(remainingMs)}</span> ago it was <span className="text-slate-100 font-medium">{formatClock(new Date(current.getTime() - Math.abs(remainingMs)))}</span>.
                      </>
                    ) : (
                      <>
                        The goal ended <span className="text-slate-100 font-medium">{humanize(-remainingMs)}</span> ago. <span className="text-slate-100 font-medium">{humanize(-remainingMs)}</span> ago it was <span className="text-slate-100 font-medium">{formatClock(new Date(current.getTime() - Math.abs(remainingMs)))}</span>.
                      </>
                    )}
                  </div>
                ) : (
                  <p className="text-slate-300">Set times to view contextual timestamps.</p>
                )}
              </section>

              <footer className="mt-10 text-xs text-slate-500">
                <p>Local time zone: {Intl.DateTimeFormat().resolvedOptions().timeZone}</p>
              </footer>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<TimeProgressApp />);
    </script>
  </body>
</html>
